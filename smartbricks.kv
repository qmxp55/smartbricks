#:kivy 1.11.1
#:import win kivy.core.window

WindowManager:
    InitWindow:
    NewWindow
    GalleryWindow:
        id: galleryid
    SetupWindow:
        #id: second
        galleryid: galleryid
    ResultWindow:

<CustButton@Button>:
    font_size: 40
    color: 0.3, 0.6, 0.7, 1

<NewWindow>:

    name: 'new'
    id: newid

    GridLayout:
        cols: 1
        padding: 20
        spacing: 20
        #pos_hint_y: 'top'

        BoxLayout:
            padding:30
            size_hint_y: .1
            Label:
                text: 'CHOOSE IMAGE'
                font_size: 30

        BoxLayout:
            orientation: 'vertical'
            padding:50
            spacing: 20

            CustButton:
                text: 'CAMERA'
                size_hint_y: .15

            CustButton:
                text: 'GALLERY'
                size_hint_y: .15
                on_release: app.root.current = "gallery"

            CustButton:
                text: 'RETURN'
                size_hint_y: .15
                on_release: app.root.current = "init"



<GalleryWindow>:

    name: 'gallery'
    entry: entry
    id: galleryid

    # Providing the orentation
    #orientation: 'vertical'
    GridLayout:
        #orientation: 'vertical'
        cols: 1

        # Creating the File list / icon view
        GridLayout:

            size_hint_y: .6
            cols: 2
            #height: 20

            # Creating Icon view other side
            FileChooserListView:

                size_hint_x: .4
                id: filechooser
                path: '/home/omar/Pictures'
                canvas.before:
                    Color:
                        rgb: .5, .4, .5
                    Rectangle:
                        pos: self.pos
                        size: self.size
                on_selection: root.selected(filechooser.selection)
                on_selection: entry.text = str(filechooser.selection[0])

            Image:
                id: image
                canvas.before:
                    Color:
                        rgb: .0, .0, .5
                    Rectangle:
                        pos: self.pos
                        size: self.size
                #size: 24, 24
                #on_size: self.center = win.Window.center
                size: image.size
                #source: None

        GridLayout:

            size_hint_y: .1
            cols: 1

            TextInput:
                #size_hint_x: .8
                id: entry
                font_size: 32
                multiline: False

        BoxLayout:

            size_hint_y: .3
            orientation: 'vertical'
            padding: 40
            spacing: 20

            CustButton:
                text: "CONTINUE"
                #size_hint: .7, .05
                on_release:
                    app.root.current = 'setup'
                    #galleryid.selected(filechooser.selection)

            CustButton:
                text: "RETURN"
                #size_hint: .7, .05
                on_release:
                    app.root.current = 'new'
                    root.on_press()


# <FileWindow>:
#
#     name: 'filechoosers'
#     fullscreen: True
#
#     BoxLayout:
#         size_hint_y: 0.1
#
#         ToggleButton:
#             text: 'Icon'
#             state: 'down'
#             group: 'filechooser'
#             on_release: filechooser.view_mode = 'icon'
#
#         ToggleButton:
#             text: 'List'
#             state: 'down'
#             group: 'filechooser'
#             on_release: filechooser.view_mode = 'list'
#
#     FileChooser:
#         id: filechooser
#         path: '/home/omar/Pictures'
#
#         FileChooserIconLayout
#         FileChooserListLayout


<InitWindow>:

    name: "init"
    canvas:
        Color:
            rgba: 0.5, 0.5, 0.5, 0.5
        Rectangle:
            pos: self.pos
            size: self.size

    GridLayout:
        cols: 1
        padding: 20
        spacing: 10

        BoxLayout:
            padding: 30
            size_hint_y: 0.5
            Label:
                bold: True
                font_size: 70
                text: "SMART BRICKS"
                #size_hint_y: .5

        BoxLayout:
            orientation: 'vertical'
            padding: 50
            spacing: 50
            size_hint_y: 0.4
            CustButton:
                text: "NEW"
                pos_hint: {'x':.3}
                #pos_hint: {'x': .3, 'y': .1}
                #valign: 'middle'
                size_hint: .4, .3
                #on_press: root.setup()
                on_press: print("ouch! More gently please")
                on_release: app.root.current = 'new'
            CustButton:
                text: "LOAD"
                pos_hint: {'x':.3}
                #pos_hint: {'x': .3, 'y': .1}
                #valign: 'middle'
                size_hint: .4, .3
                on_release:

        BoxLayout:
            size_hint_y: 0.1
            Label:
                text: "Copyright (c) 2020 Omar Ruiz"
                font_size: 15
                valign: 'bottom'

<SetupWindow>:

    name: "setup"
    sel_image: sel_image

    canvas:
        Color:
            rgba: 0.5, 0.5, 0.5, 0.5
        Rectangle:
            pos: self.pos
            size: self.size

    GridLayout:
        cols: 1
        padding: 20
        spacing: 20
        #pos_hint_y: 'top'

        BoxLayout:
            padding:30
            size_hint_y: .1
            Label:
                text: 'MOSAIC SETUP'
                font_size: 30

        GridLayout:
            cols: 1
            padding: 30
            spacing: 30
            size_hint_y: .5

            BoxLayout:
                cols: 2

                Label:
                    text: 'Image:'
                    font_size: 25

                Label:
                    id: sel_image
                    #text: self.galleryid.entry.text
                    font_size: 25

            BoxLayout:
                cols: 2

                Label:
                    text: 'Minimum Brick lenght:'
                    font_size: 25
                    #size_hint_y: 0.5

                Spinner
                    id: minbrick
                    text: '8'
                    values: ('8', '16', '32', '48', '64')
                    font_size: 25

            BoxLayout:
                cols: 2

                Label:
                    text: 'Number of Colors:'
                    font_size: 25
                    #size_hint_y: 0.5

                Spinner
                    id: ncolors
                    text: '4'
                    values: ('4', '6', '8', '10', '12')
                    font_size: 25


        #GridLayout:
        #    size_hint_y: 0.2

        BoxLayout:

            size_hint_y: 0.4
            spacing: 30
            orientation: 'vertical'

            CustButton:
                text: 'CREATE MOSAIC'
                size_hint: .6, .2
                pos_hint: {'x':.2}
                on_release: app.root.current = "result"
                on_release: root.createBrick(sel_image.text, ncolors.text, minbrick.text)

            CustButton:
                text: 'CANCELL'
                pos_hint: {'x':.3}
                size_hint: .4, .1

                on_release: app.root.current = "init"

<ResultWindow>:

    name: "result"
    image: image
    #save_btn2: save_btn2

    canvas:
        Color:
            rgba: 0.5, 0.5, 0.5, 0.5
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.1
            id: tp

            CustButton:
                id: save_btn2
                text: 'SAVE'
                size_hint_x: 0.2
                on_press: root.show_popup()

            CustButton:
                text: 'NEW'
                size_hint_x: 0.2

            CustButton:
                text: 'BRICKS'
                size_hint_x: 0.2

            CustButton:
                text: 'COLORS'
                size_hint_x: 0.2

        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.7

            Image:
                id: image
                size: image.size


<P>:
    id: popup
    cancel_btn: cancel_btn
    save_btn: save_btn
    pname: pname
    #title: 'save current project'

    GridLayout:
        cols: 1
        padding: 10
        spacing: 10

        TextInput:
            #size_hint_x: .8
            text: 'test'
            id: pname
            font_size: 28
            multiline: False
            size_hint_y: .1

        CustButton:
            id: save_btn
            text: 'SAVE'
            pos_hint: {'x':.3}
            size_hint: .4, .1
            #on_release: root.saveProject(pname.text)
            #on_release: root.close_pop()

        CustButton:
            id: cancel_btn
            text: 'CANCEL'
            pos_hint: {'x':.3}
            size_hint: .4, .1
            #on_release: root.close_pop()
